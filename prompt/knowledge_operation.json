{
  "metadata": {
    "file": "cyberteam_prompts_part3.json",
    "version": "1.0",
    "description": "Knowledge operations: MAP and RAG",
    "operations_included": ["map_threat_knowledge", "rag_query_threat_intel"]
  },
  
  "prompt_templates": {
    
    "map_threat_knowledge": {
      "operation_name": "Threat Knowledge Graph Mapping",
      "description": "Extract structured relationships between cybersecurity entities",
      "system_prompt": "You are a cybersecurity knowledge engineer specializing in threat intelligence relationship extraction. You excel at identifying complex relationships between threat actors, tools, infrastructure, and techniques to build comprehensive threat models.",
      
      "user_template": "**KNOWLEDGE EXTRACTION MISSION:** Analyze the threat report and extract ALL meaningful relationships between cybersecurity entities to construct a comprehensive threat knowledge graph.\n\n**ENTITY CATEGORIES:**\n- **THREAT ACTORS:** APT groups, cybercriminals, state-sponsored teams, individuals\n- **MALWARE:** Families, variants, tools, exploits, frameworks\n- **INFRASTRUCTURE:** IPs, domains, URLs, servers, certificates, ASNs\n- **VULNERABILITIES:** CVEs, exploit types, attack surfaces\n- **ORGANIZATIONS:** Targets, victims, affected sectors, vendors\n- **TECHNIQUES:** MITRE ATT&CK techniques, TTPs, procedures\n- **CAMPAIGNS:** Operations, attack series, coordinated activities\n- **GEOGRAPHIC:** Countries, regions, geopolitical entities\n\n**RELATIONSHIP TYPES TO EXTRACT:**\n\n**OPERATIONAL RELATIONSHIPS:**\n- uses(Actor, Tool) - Actor deploys specific malware/tool\n- operates(Actor, Infrastructure) - Actor controls C2/servers\n- targets(Actor, Organization) - Actor focuses on specific victims\n- exploits(Actor/Malware, Vulnerability) - Exploitation relationships\n- communicates_with(Malware, Infrastructure) - C2 communications\n- drops(Malware, Malware) - Payload deployment chains\n- affects(Vulnerability, Software) - Vulnerability impact scope\n- hosts(Infrastructure, Resource) - Server hosting relationships\n\n**ATTRIBUTION RELATIONSHIPS:**\n- attributed_to(Campaign, Actor) - Campaign attribution\n- associated_with(Entity, Entity) - Intelligence linking\n- similar_to(Entity, Entity) - Behavioral/technical similarities\n- part_of(Attack, Campaign) - Attack sequence membership\n- developed_by(Tool, Actor) - Tool development attribution\n- sponsored_by(Actor, Nation) - State sponsorship\n\n**TECHNICAL RELATIONSHIPS:**\n- connects_to(System, Infrastructure) - Network connections\n- resolves_to(Domain, IP) - DNS resolution mappings\n- contains(File, Hash) - File composition\n- implements(Malware, Technique) - TTP implementation\n- mitigates(Defense, Technique) - Defensive countermeasures\n- detects(Rule, Technique) - Detection capabilities\n\n**TEMPORAL RELATIONSHIPS:**\n- precedes(Event, Event) - Sequential attack phases\n- concurrent_with(Event, Event) - Simultaneous activities\n- follows(Campaign, Campaign) - Campaign succession\n\n**EXTRACTION GUIDELINES:**\n1. **PRECISION:** Extract relationships explicitly stated or strongly implied\n2. **EVIDENCE:** Base relationships on concrete evidence in text\n3. **SPECIFICITY:** Use specific entity names when available\n4. **CONFIDENCE:** Score based on evidence strength and clarity\n5. **COMPREHENSIVENESS:** Extract both obvious and subtle relationships\n6. **CONTEXT:** Consider domain-specific relationship semantics\n\n**CONFIDENCE SCORING:**\n- **0.9-1.0:** Explicitly stated with strong evidence\n- **0.7-0.8:** Clearly implied with supporting context\n- **0.5-0.6:** Reasonable inference from available data\n- **0.3-0.4:** Weak inference requiring additional validation\n- **0.1-0.2:** Speculative relationship with minimal evidence\n\n**INPUT TEXT:**\n{text}\n\n**OUTPUT FORMAT:**\n```json\n{\n    \"knowledge_graph\": {\n        \"entities\": {\n            \"threat_actors\": [\"APT29\", \"Cozy Bear\"],\n            \"malware\": [\"Cobalt Strike\", \"PowerShell scripts\"],\n            \"infrastructure\": [\"185.100.87.21\", \"evil-domain.com\"],\n            \"vulnerabilities\": [\"CVE-2024-21345\"],\n            \"organizations\": [\"government agencies\"],\n            \"techniques\": [\"T1566.001\", \"T1059.001\"],\n            \"campaigns\": [\"December 2024 Phishing Campaign\"]\n        },\n        \n        \"relationships\": [\n            {\n                \"subject\": \"APT29\",\n                \"predicate\": \"conducts\",\n                \"object\": \"December 2024 Phishing Campaign\",\n                \"confidence\": 0.95,\n                \"evidence\": \"Report explicitly states APT29 conducted the campaign\",\n                \"relationship_type\": \"operational\"\n            },\n            {\n                \"subject\": \"December 2024 Phishing Campaign\",\n                \"predicate\": \"exploits\",\n                \"object\": \"CVE-2024-21345\",\n                \"confidence\": 0.9,\n                \"evidence\": \"Campaign leveraged this vulnerability for initial access\",\n                \"relationship_type\": \"technical\"\n            },\n            {\n                \"subject\": \"PowerShell scripts\",\n                \"predicate\": \"communicates_with\",\n                \"object\": \"185.100.87.21\",\n                \"confidence\": 0.85,\n                \"evidence\": \"Malware established C2 communication\",\n                \"relationship_type\": \"technical\"\n            }\n        ]\n    },\n    \n    \"graph_statistics\": {\n        \"total_entities\": 15,\n        \"total_relationships\": 12,\n        \"relationship_types\": {\n            \"operational\": 6,\n            \"technical\": 4,\n            \"attribution\": 2\n        },\n        \"confidence_distribution\": {\n            \"high_confidence\": 8,\n            \"medium_confidence\": 3,\n            \"low_confidence\": 1\n        }\n    },\n    \n    \"threat_model\": {\n        \"attack_flow\": [\"initial_access\", \"execution\", \"persistence\", \"command_control\"],\n        \"key_relationships\": [\"APT29->conducts->Campaign\", \"Campaign->exploits->CVE-2024-21345\"],\n        \"attribution_strength\": \"strong\",\n        \"intelligence_gaps\": [\"additional infrastructure\", \"full victim list\"]\n    }\n}\n```",
      
      "temperature": 0.3,
      "max_tokens": 2048,
      "validation_criteria": [
        "All relationships have confidence scores",
        "Evidence provided for each relationship",
        "Entities properly categorized",
        "Relationship types correctly identified"
      ]
    },

    "rag_query_threat_intel": {
      "operation_name": "Retrieval-Augmented Generation Query Formulation",
      "description": "Generate optimized search queries for threat intelligence retrieval",
      "system_prompt": "You are a cybersecurity research specialist expert in formulating precise search queries for threat intelligence platforms. You understand how different intelligence sources organize information and can optimize queries for maximum relevant retrieval.",
      
      "user_template": "**INTELLIGENCE SEARCH MISSION:** Formulate comprehensive and optimized search queries to retrieve current threat intelligence for the specified topic.\n\n**SEARCH TOPIC:** {query}\n\n**QUERY OPTIMIZATION FRAMEWORK:**\n\n**1. INTENT ANALYSIS:**\n- **THREAT ACTOR INTELLIGENCE:** Attribution, TTPs, campaign analysis, infrastructure\n- **MALWARE ANALYSIS:** Family research, IOCs, behavioral analysis, variants\n- **VULNERABILITY RESEARCH:** Exploit analysis, patch status, impact assessment\n- **CAMPAIGN TRACKING:** Attack correlation, timeline analysis, victim identification\n- **GENERAL CTI:** Multi-faceted threat landscape analysis\n\n**2. SOURCE OPTIMIZATION:**\n- **MITRE ATT&CK:** Technique mappings, group profiles, software descriptions\n- **MITRE CVE/NVD:** Vulnerability details, CVSS scores, patch information\n- **VirusTotal:** Malware analysis, IOC intelligence, behavioral reports\n- **CISA/US-CERT:** Government advisories, alerts, mitigation guidance\n- **Mandiant/FireEye:** APT intelligence, campaign analysis, attribution\n- **Academic/Research:** Technical papers, conference presentations\n- **Vendor Reports:** Security company intelligence and analysis\n\n**3. SEARCH STRATEGY:**\n- Extract 5-10 primary search terms from the topic\n- Identify synonyms and alternative terminology\n- Consider technical identifiers (CVEs, hashes, IPs)\n- Include temporal constraints when relevant\n- Use boolean operators effectively (AND, OR, NOT, quotes)\n- Apply site-specific search optimization\n\n**4. QUERY VARIANTS:**\n- **PRIMARY QUERY:** Broad comprehensive search\n- **TECHNICAL QUERY:** Specific technical indicators\n- **RECENT ACTIVITY:** Time-bounded searches\n- **SOURCE-SPECIFIC:** Optimized for particular platforms\n\n**AVAILABLE SOURCES:** {sources}\n\n**SEARCH TERM SELECTION:**\n- **PRIMARY TERMS:** Core entities (actor names, malware families, CVEs)\n- **CONTEXTUAL TERMS:** Related concepts (sectors, regions, techniques)\n- **TECHNICAL TERMS:** IOCs, file hashes, infrastructure indicators\n- **TEMPORAL TERMS:** Years, months, \\\"recent\\\", \\\"latest\\\"\n- **SYNONYMS:** Alternative names, aliases, translations\n\n**OUTPUT FORMAT:**\n```json\n{\n    \"query_analysis\": {\n        \"search_intent\": \"threat_actor_research\",\n        \"intelligence_type\": \"attribution_and_ttps\",\n        \"primary_entities\": [\"APT29\", \"Cozy Bear\", \"phishing\"],\n        \"temporal_scope\": \"2024_recent_activity\",\n        \"geographic_focus\": \"global\",\n        \"urgency_level\": \"high\",\n        \"expected_result_types\": [\"reports\", \"iocs\", \"techniques\"]\n    },\n    \n    \"optimized_queries\": {\n        \"primary_comprehensive\": \"APT29 OR \\\"Cozy Bear\\\" phishing campaign 2024 government targets IOCs\",\n        \n        \"source_specific\": {\n            \"mitre_attack\": \"APT29 techniques site:attack.mitre.org\",\n            \"virustotal\": \"APT29 2024 malware samples site:virustotal.com\", \n            \"cisa_alerts\": \"APT29 OR \\\"Cozy Bear\\\" advisory site:cisa.gov\",\n            \"mandiant_intel\": \"APT29 campaign analysis site:mandiant.com OR site:fireeye.com\",\n            \"academic_research\": \"APT29 attribution analysis filetype:pdf\"\n        },\n        \n        \"technical_indicators\": \"APT29 IOCs 2024 (IP OR domain OR hash OR CVE)\",\n        \n        \"recent_activity\": \"APT29 \\\"Cozy Bear\\\" (2024 OR \\\"recent\\\" OR \\\"latest\\\") campaign\",\n        \n        \"victim_intelligence\": \"APT29 targets victims government (\\\"Eastern Europe\\\" OR \\\"NATO\\\")\",\n        \n        \"defensive_intelligence\": \"APT29 detection rules signatures YARA (Splunk OR SIEM)\"\n    },\n    \n    \"search_terms\": {\n        \"primary\": [\"APT29\", \"Cozy Bear\", \"phishing\", \"2024\"],\n        \"secondary\": [\"government\", \"campaign\", \"IOCs\", \"attribution\"],\n        \"technical\": [\"CVE\", \"malware\", \"C2\", \"infrastructure\"],\n        \"synonyms\": [\"The Dukes\", \"CozyDuke\", \"spear-phishing\"]\n    },\n    \n    \"search_strategy\": {\n        \"boolean_operators\": \"OR for aliases, AND for concepts, quotes for phrases\",\n        \"site_targeting\": \"Use site: operator for authoritative sources\",\n        \"temporal_filtering\": \"Include year/recent terms for current intelligence\",\n        \"technical_precision\": \"Use specific identifiers when available\"\n    },\n    \n    \"expected_results\": {\n        \"result_count_estimate\": \"100-500 relevant documents\",\n        \"source_distribution\": {\n            \"government\": 30,\n            \"commercial_intel\": 40,\n            \"academic\": 20,\n            \"open_source\": 10\n        },\n        \"intelligence_value\": \"high\",\n        \"freshness_requirement\": \"within_6_months\"\n    }\n}\n```",
      
      "temperature": 0.4,
      "max_tokens": 1536,
      "validation_criteria": [
        "Queries optimized for target sources",
        "Boolean operators used correctly", 
        "Temporal constraints included when relevant",
        "Technical terms and synonyms covered"
      ]
    }
  },
  
  "usage_examples": {
    "map_example": {
      "input": "APT29 used Cobalt Strike to target government agencies via CVE-2024-1234",
      "expected_relationships": [
        "APT29 -> uses -> Cobalt Strike",
        "APT29 -> targets -> government agencies", 
        "Cobalt Strike -> exploits -> CVE-2024-1234"
      ]
    },
    "rag_example": {
      "query": "APT29 recent campaigns 2024",
      "optimized_search": "APT29 OR \\\"Cozy Bear\\\" campaign 2024 (site:mitre.org OR site:mandiant.com)",
      "expected_sources": ["MITRE ATT&CK", "Mandiant reports", "CISA advisories"]
    }
  }
}