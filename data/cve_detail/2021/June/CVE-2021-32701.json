{"CVE Code": "CVE-2021-32701", "Description": "ORY Oathkeeper is an Identity & Access Proxy (IAP) and Access Control Decision API that authorizes HTTP requests based on sets of Access Rules. When you make a request to an endpoint that requires the scope `foo` using an access token granted with that `foo` scope, introspection will be valid and that token will be cached. The problem comes when a second requests to an endpoint that requires the scope `bar` is made before the cache has expired. Whether the token is granted or not to the `bar` scope, introspection will be valid. A patch will be released with `v0.38.12-beta.1`. Per default, caching is disabled for the `oauth2_introspection` authenticator. When caching is disabled, this vulnerability does not exist. The cache is checked in [`func (a *AuthenticatorOAuth2Introspection) Authenticate(...)`](https://github.com/ory/oathkeeper/blob/6a31df1c3779425e05db1c2a381166b087cb29a4/pipeline/authn/authenticator_oauth2_introspection.go#L152). From [`tokenFromCache()`](https://github.com/ory/oathkeeper/blob/6a31df1c3779425e05db1c2a381166b087cb29a4/pipeline/authn/authenticator_oauth2_introspection.go#L97) it seems that it only validates the token expiration date, but ignores whether the token has or not the proper scopes. The vulnerability was introduced in PR #424. During review, we failed to require appropriate test coverage by the submitter which is the primary reason that the vulnerability passed the review process.", "NVD Link": "https://nvd.nist.gov/vuln/detail/CVE-2021-32701", "Vulnerability Categories": "N/A", "Affected Products": "\nORY\u00bbOathkeeper\u00bbVersion:0.38.0UpdateBeta2cpe:2.3:a:ory:oathkeeper:0.38.0:beta2:*:*:*:*:*:*Matching versions\nORY\u00bbOathkeeper\u00bbVersion:0.38.1UpdateBeta2cpe:2.3:a:ory:oathkeeper:0.38.1:beta2:*:*:*:*:*:*Matching versions\nORY\u00bbOathkeeper\u00bbVersion:0.38.2UpdateBeta1cpe:2.3:a:ory:oathkeeper:0.38.2:beta1:*:*:*:*:*:*Matching versions\nORY\u00bbOathkeeper\u00bbVersion:0.38.3UpdateBeta1cpe:2.3:a:ory:oathkeeper:0.38.3:beta1:*:*:*:*:*:*Matching versions\nORY\u00bbOathkeeper\u00bbVersion:0.38.4UpdateBeta1cpe:2.3:a:ory:oathkeeper:0.38.4:beta1:*:*:*:*:*:*Matching versions\nORY\u00bbOathkeeper\u00bbVersion:0.38.5UpdateBeta1cpe:2.3:a:ory:oathkeeper:0.38.5:beta1:*:*:*:*:*:*Matching versions\nORY\u00bbOathkeeper\u00bbVersion:0.38.6UpdateBeta1cpe:2.3:a:ory:oathkeeper:0.38.6:beta1:*:*:*:*:*:*Matching versions\nORY\u00bbOathkeeper\u00bbVersion:0.38.7UpdateBeta1cpe:2.3:a:ory:oathkeeper:0.38.7:beta1:*:*:*:*:*:*Matching versions\nORY\u00bbOathkeeper\u00bbVersion:0.38.8UpdateBeta1cpe:2.3:a:ory:oathkeeper:0.38.8:beta1:*:*:*:*:*:*Matching versions\nORY\u00bbOathkeeper\u00bbVersion:0.38.9UpdateBeta1cpe:2.3:a:ory:oathkeeper:0.38.9:beta1:*:*:*:*:*:*Matching versions\nORY\u00bbOathkeeper\u00bbVersion:0.38.10UpdateBeta2cpe:2.3:a:ory:oathkeeper:0.38.10:beta2:*:*:*:*:*:*Matching versions\nORY\u00bbOathkeeper\u00bbVersion:0.38.11UpdateBeta1cpe:2.3:a:ory:oathkeeper:0.38.11:beta1:*:*:*:*:*:*Matching versions", "EPSS Score": "0.13% Probability of exploitation activity in the next 30 days\n~ 47 % Percentile, the proportion of vulnerabilities that are scored at or less", "EPSS History": "\n #  Date  Old EPSS Score  New EPSS Score  Delta (New - Old) \n 1  2024-03-07  0.12%  0.13%  +0.01 \n 2  2024-01-27  0.11%  0.12%  +0.00 \n 3  2023-03-07  0.95%  0.11%  -0.84 ", "CVSS Scores": "4.3", "CWE": [{"CWE_ID": "CWE-863 Incorrect Authorization", "CWE_link": "/cwe-details/863/Incorrect-Authorization.html"}], "Reference": [{"ref_link": "https://github.com/ory/oathkeeper/security/advisories/GHSA-qvp4-rpmr-xwrr", "ref_desc": "Possible bypass of token claim validation when OAuth2 Introspection caching is enabled \u00b7 Advisory \u00b7 ory/oathkeeper \u00b7 GitHubThird Party Advisory", "ref_cve_link": "N/A"}, {"ref_link": "https://github.com/ory/oathkeeper/commit/1f9f625c1a49e134ae2299ee95b8cf158feec932", "ref_desc": "Merge pull request from GHSA-qvp4-rpmr-xwrr \u00b7 ory/oathkeeper@1f9f625 \u00b7 GitHubPatch;Third Party Advisory", "ref_cve_link": "N/A"}, {"ref_link": "https://github.com/ory/oathkeeper/pull/424", "ref_desc": "feat: cache incoming oauth introspect tokens by pike1212 \u00b7 Pull Request #424 \u00b7 ory/oathkeeper \u00b7 GitHubPatch;Third Party Advisory", "ref_cve_link": "N/A"}]}