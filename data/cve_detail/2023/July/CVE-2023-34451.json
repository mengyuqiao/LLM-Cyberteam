{"CVE Code": "CVE-2023-34451", "Description": "CometBFT is a Byzantine Fault Tolerant (BFT) middleware that takes a state transition machine and replicates it on many machines. The mempool maintains two data structures to keep track of outstanding transactions: a list and a map.\nThese two data structures are supposed to be in sync all the time in the sense that the map tracks the index (if any) of the transaction in the list. In `v0.37.0`, and `v0.37.1`, as well as in `v0.34.28`, and all previous releases of the CometBFT repo2, it is possible to have them out of sync. When this happens, the list may contain several copies of the same transaction. Because the map tracks a single index, it is then no longer possible to remove all the copies of the transaction from the list. This happens even if the duplicated transaction is later committed in a block. The only way to remove the transaction is by restarting the node.\n\nThe above problem can be repeated on and on until a sizable number of transactions are stuck in the mempool, in order to try to bring down the target node. The problem is fixed in releases `v0.34.29` and `v0.37.2`. Some workarounds are available. Increasing the value of `cache_size` in `config.toml` makes it very difficult to effectively attack a full node. Not exposing the transaction submission RPC's would mitigate the probability of a successful attack, as the attacker would then have to create a modified (byzantine) full node to be able to perform the attack via p2p.", "NVD Link": "https://nvd.nist.gov/vuln/detail/CVE-2023-34451", "Vulnerability Categories": "N/A", "Affected Products": "\nCometbft\u00bbCometbftVersions  from including (>=) 0.37.0andbefore (<) 0.37.2cpe:2.3:a:cometbft:cometbft:*:*:*:*:*:*:*:*Matching versions\nCometbft\u00bbCometbftVersions  from including (>=) 0.34.28andbefore (<) 0.34.29cpe:2.3:a:cometbft:cometbft:*:*:*:*:*:*:*:*Matching versions", "EPSS Score": "0.13% Probability of exploitation activity in the next 30 days\n~ 49 % Percentile, the proportion of vulnerabilities that are scored at or less", "EPSS History": "\n #  Date  Old EPSS Score  New EPSS Score  Delta (New - Old) \n 1  2024-07-09  0.07%  0.13%  +0.07 \n 2  2024-06-02  0.05%  0.07%  +0.01 \n 3  2023-07-18  0.05%  0.05%  +0.01 ", "CVSS Scores": "8.2", "CWE": [{"CWE_ID": "CWE-401 Missing Release of Memory after Effective Lifetime", "CWE_link": "/cwe-details/401/Missing-Release-of-Memory-after-Effective-Lifetime.html"}], "Reference": [{"ref_link": "https://github.com/cometbft/cometbft/pull/890", "ref_desc": "Prevent a transaction to appear twice in the mempool by otrack \u00b7 Pull Request #890 \u00b7 cometbft/cometbft \u00b7 GitHubExploit;Issue Tracking;Patch", "ref_cve_link": "N/A"}, {"ref_link": "https://github.com/cometbft/cometbft/security/advisories/GHSA-w24w-wp77-qffm", "ref_desc": "Duplicate transactions in the mempool's data structures \u00b7 Advisory \u00b7 cometbft/cometbft \u00b7 GitHubExploit;Mitigation;Vendor Advisory", "ref_cve_link": "N/A"}, {"ref_link": "https://github.com/tendermint/tendermint/pull/2778", "ref_desc": "mempool no gossip back by ValarDragon \u00b7 Pull Request #2778 \u00b7 tendermint/tendermint \u00b7 GitHubIssue Tracking;Patch", "ref_cve_link": "N/A"}]}