{"CVE Code": "CVE-2023-29020", "Description": "@fastify/passport is a port of passport authentication library for the Fastify ecosystem. The CSRF (Cross-Site Request Forger) protection enforced by the `@fastify/csrf-protection` library, when combined with `@fastify/passport` in affected versions, can be bypassed by network and same-site attackers. `fastify/csrf-protection` implements the synchronizer token pattern (using plugins `@fastify/session` and `@fastify/secure-session`) by storing a random value used for CSRF token generation in the `_csrf` attribute of a user's session. The `@fastify/passport` library does not clear the session object upon authentication, preserving the `_csrf` attribute between pre-login and authenticated sessions. Consequently, CSRF tokens generated before authentication are still valid. Network and same-site attackers can thus obtain a CSRF token for their pre-session, fixate that pre-session in the victim's browser via cookie tossing, and then perform a CSRF attack after the victim authenticates. As a solution, newer versions of `@fastify/passport` include the configuration options: `clearSessionOnLogin (default: true)` and `clearSessionIgnoreFields (default: ['passport', 'session'])` to clear all the session attributes by default, preserving those explicitly defined in `clearSessionIgnoreFields`.", "NVD Link": "https://nvd.nist.gov/vuln/detail/CVE-2023-29020", "Vulnerability Categories": "Cross-site request forgery (CSRF)", "Affected Products": "\nFastify\u00bbPassport\u00bbForNode.jsVersions  from including (>=) 2.0.0andbefore (<) 2.3.0cpe:2.3:a:fastify:passport:*:*:*:*:*:node.js:*:*Matching versions\nFastify\u00bbPassport\u00bbForNode.jsVersions  before (<) 1.1.0cpe:2.3:a:fastify:passport:*:*:*:*:*:node.js:*:*Matching versions", "EPSS Score": "0.08% Probability of exploitation activity in the next 30 days\n~ 34 % Percentile, the proportion of vulnerabilities that are scored at or less", "EPSS History": "\n #  Date  Old EPSS Score  New EPSS Score  Delta (New - Old) \n 1  2024-10-01  0.07%  0.08%  +0.01 \n 2  2024-04-27  0.06%  0.07%  +0.01 \n 3  2024-03-21  0.06%  0.06%  0.00 \n 4  2023-05-04  0.05%  0.06%  +0.02 ", "CVSS Scores": "6.5", "CWE": [{"CWE_ID": "CWE-352 Cross-Site Request Forgery (CSRF)", "CWE_link": "/cwe-details/352/Cross-Site-Request-Forgery-CSRF-.html"}, {"CWE_ID": "CWE-384 Session Fixation", "CWE_link": "/cwe-details/384/Session-Fixation.html"}], "Reference": [{"ref_link": "https://github.com/fastify/fastify-passport/commit/07c90feab9cba0dd4779e47cfb0717a7e2f01d3d", "ref_desc": "Merge pull request from GHSA-2ccf-ffrj-m4qw \u00b7 fastify/fastify-passport@07c90fe \u00b7 GitHubPatch", "ref_cve_link": "N/A"}, {"ref_link": "https://owasp.org/www-community/attacks/csrf", "ref_desc": "Cross Site Request Forgery (CSRF) | OWASP FoundationTechnical DescriptionCVEs referencing this url", "ref_cve_link": "https://www.cvedetails.com/reference-url-info/Hqv7YMMNT8Uu-Q0B930T-NiWiRw.html"}, {"ref_link": "https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html#synchronizer-token-pattern", "ref_desc": "Cross-Site Request Forgery Prevention - OWASP Cheat Sheet SeriesTechnical Description", "ref_cve_link": "N/A"}, {"ref_link": "https://github.com/fastify/fastify-passport/security/advisories/GHSA-2ccf-ffrj-m4qw", "ref_desc": "CSRF token fixation in fastify-passport \u00b7 Advisory \u00b7 fastify/fastify-passport \u00b7 GitHubVendor Advisory", "ref_cve_link": "N/A"}]}